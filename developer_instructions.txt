Robust Popup & Animation Implementation Guide

Use these instructions to replicate the button, startup animation, and popup functionality in other workspaces without debugging loops.

---

1. The "Invisible Button" Rule (Scroll Animations)
Problem: Buttons or elements appear invisible (opacity: 0) and never appear.
Cause: The element has a CSS animation class (e.g., .fade-in-up) but is NOT being watched by the IntersectionObserver in JavaScript.

The Protocol:
- HTML: Apply the class: <div class="hero-buttons fade-in-up">
- JavaScript (Critical): You MUST add the selector to the animateElements list in main.js.
   // main.js - ADD YOUR CLASS HERE
   const animateElements = document.querySelectorAll('..., .btn, .hero-buttons, ...');
- Check: If an element needs to animate, it must be in that querySelector list.

---

2. Popup Form Pre-Selection Strategy
Problem: Popups open, but the specific service/option is not selected or the form is blank.
Cause: Mismatch between the "Service Name" string passed in HTML and the "Option Value" in the form/database.

The Protocol:
- Exact String Matching: The string passed in onclick MUST match the form option exactly (Case-sensitive, spacing-sensitive).
   * Correct: onclick="showServicesPopup('Ultra-modern Websites')"
   * Target: Form Option Value = "Ultra-modern Websites"
   
- Standard Function Pattern:
   Use this pattern for the popup handler to ensure robust pre-filling:
   
   function showServicesPopup(serviceName) {
       // 1. Show the popup overlay
       document.getElementById('servicesPopup').style.display = 'block';
       
       // 2. Target the iframe or form input
       const iframe = document.getElementById('highlevel-form-iframe');
       
       // 3. Construct URL with query param
       // NOTE: Ensure your form provider (GoHighLevel, etc.) accepts this specific param key (e.g., 'service_interested')
       if (serviceName) {
           const specificUrl = `https://link.to.form?service=${encodeURIComponent(serviceName)}`;
           iframe.src = specificUrl;
       }
   }

---

3. Z-Index Layering Standard
To prevent "unclickable" buttons or popups hiding behind navbars:

Element                 | Z-Index | Notes
----------------------- | ------- | ------------------------
Standard Content        | 1-10    | Text, images, cards
Sticky Navbar           | 100     | Must float above content
Floating Widgets        | 900     | Chat bots, WhatsApp buttons
Popup Overlay           | 998     | The dark background dimming
Popup Content           | 999     | The actual modal window
Notifications/Toasts    | 1000+   | Urgent alerts

---

4. Universal "Hero" Structure
For consistent "wow" factor hero sections, use this structure which is pre-validated for the animation engine:

<section class="hero-section">
    <!-- Text Content -->
    <div class="hero-content fade-in-up"> <!-- "fade-in-up" handles the entry -->
       <h1>Headline</h1>
       <div class="hero-buttons fade-in-up"> <!-- "fade-in-up" added here too -->
           <button class="btn btn-primary">Primary Action</button>
       </div>
    </div>
</section>

*Note: Ensure .hero-content and .hero-buttons are both in the IntersectionObserver list.*

---

5. Full-Screen Fixed Popup Pattern (The "Nuclear" Solution)
Problem: Popups are cut off, not centered, scrolling inside the iframe vs grid, or getting blocked by parent container styles (overflow: hidden).
Cause: Relying on `position: absolute` or standard CSS flows within complex layouts allows parent styles to clip or displace the popup.

The Protocol (Use EXACTLY this structure):
This uses `position: fixed !important` to escape all specific DOM constraints and `100vh`/`100vw` to force full screen.

HTML Structure:
```html
<div id="UNIQUE_POPUP_ID" class="conditional-content hidden zoom-in" 
     style="position: fixed !important; inset: 0 !important; width: 100vw !important; height: 100vh !important; background: rgba(0, 0, 0, 0.95) !important; z-index: 2147483647 !important; margin: 0 !important; padding: 0 !important; max-width: none !important; max-height: none !important; overflow: hidden !important; display: none;">
    
    <!-- 1. Centering Wrapper -->
    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
        
        <!-- 2. Scrollable Container (Handles tall forms on mobile) -->
        <div style="position: relative; width: 100%; height: 100%; background: transparent; overflow-y: auto !important; -webkit-overflow-scrolling: touch;">
            
            <!-- 3. Close Button (Fixed to Viewport so it never scrolls away) -->
            <button class="close-form-btn" onclick="this.closest('#UNIQUE_POPUP_ID').classList.add('hidden'); this.closest('#UNIQUE_POPUP_ID').style.display='none';" title="Close Form"
                style="background: #ff6b00 !important; color: white; position: fixed; top: 20px; right: 20px; border-radius: 50%; width: 50px; height: 50px; font-size: 30px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); border: none; cursor: pointer; z-index: 2147483647;">&times;</button>
            
            <!-- 4. Iframe (Natural Height) -->
            <!-- Note: NO scrolling="no". Min-height 100vh ensures it fills screen. -->
            <iframe src="YOUR_FORM_URL"
                style="width: 100%; height: 100%; min-height: 100vh; border: none;" 
                title="Form Title">
            </iframe>
        </div>
    </div>
</div>
```

Key Rules:
1. **Container**: `position: fixed !important`, `inset: 0`, `z-index: 2147483647` (Max Integer).
2. **Scroll Strategy**: The *Container* (`overflow-y: auto`) scrolls, NOT the iframe.
3. **Iframe**: `min-height: 100vh`, `border: none`. Do NOT use `scrolling="no"`.
4. **Close Button**: `position: fixed` (relative to screen, not content) so it's always accessible.

---

6. Layout & Spacing Protocol (Header Clearance)
**Problem:** The Hero section content is hidden behind the fixed navigation bar on Desktop, or has inconsistent spacing on Mobile.
**Cause:** The fixed navbar (approx 170px tall) overlays the content flow. Standard padding is insufficient.

**The Protocol:**
- **Desktop (min-width: 769px):**
  You MUST enforce a `padding-top` of at least **220px** for any hero section to ensure visual clearance.
  You MUST enforce `justify-content: flex-start` to prevent vertical centering (which pushes content up behind the header).
  
  ```css
  @media (min-width: 769px) {
      .hero, .hero.website-hero-override, #home.hero {
          padding-top: 220px !important; /* Critical Layout Fix */
          justify-content: flex-start !important; /* Prevent centering overlap */
          min-height: 60vh;
      }
  }
  ```

- **Mobile (max-width: 768px):**
  Use `padding-top: 140px` (or adjusted based on specific design) but ensure it is handled separately from desktop rules.

---

7. Deployment & Cache Busting Protocol
**Problem:** Users (and you) do not see changes immediately after deploying because browsers cache `style.css` aggressively.
**Cause:** The filename `style.css` hasn't changed, so the browser uses the local copy.

**The Protocol:**
- **NEVER** deploy a CSS change without updating the version query parameter in ALL HTML files.
- **The Tool:** Use `smart_update_css.ps1` (or `.py`) in the root directory.
  - Command: `powershell -ExecutionPolicy Bypass -File smart_update_css.ps1`
  - Logic: It finds `style.css?v=XXX` and increments/updates it to the target version in ALL 18+ HTML files instantly.
- **Action:** run this script BEFORE `git push`.

